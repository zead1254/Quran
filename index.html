<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تلاوات د. محمد نبيل | موقع رسمي</title>
  <meta name="description" content="تلاوات قرآنية بصوت د. محمد نبيل ." />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#f8f5f0; /* لون خلفية إسلامي فاتح */
      --text:#2a2118; /* لون نص دافئ */
      --muted:#6b5d4d; /* نص ثانوي */
      --green:#1b6b43; /* أخضر أساسي */
      --olive:#2e5e4e; /* زيتي غامق */
      --gold:#c9a227;  /* لون ذهبي */
      --card:#fff9f0; /* لون بطاقات */
      --shadow: 0 10px 25px rgba(0,0,0,.05);
      --radius: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* خلفية زخرفية إسلامية متحركة */
    .pattern{position:fixed; inset:0; z-index:-2; opacity:.4; filter:saturate(0.9);}
    .pattern::before{
      content:""; position:absolute; inset:-20%; z-index:-2; transform-origin:50% 50%;
      background:
        radial-gradient(circle at 25% 25%, rgba(201,162,39,.06) 0 18%, transparent 19%) 0 0/90px 90px,
        radial-gradient(circle at 75% 75%, rgba(27,107,67,.06) 0 18%, transparent 19%) 0 0/90px 90px,
        conic-gradient(from 45deg at 50% 50%, rgba(201,162,39,.05) 0 25%, transparent 0 100%);
      animation: rotateBg 90s linear infinite;
    }
    @keyframes rotateBg{to{transform:rotate(360deg)}}

    /* شريط علوي */
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(1.2) blur(8px);
      background:rgba(248,245,240,.92);
      border-bottom:1px solid rgba(201,162,39,.15);
      box-shadow:0 2px 15px rgba(0,0,0,.05);
    }
    .nav{max-width:1200px; margin:auto; display:flex; align-items:center; justify-content:space-between; padding:12px 20px;}
    .brand{display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit}
    .brand .logo{width:42px; height:42px; display:grid; place-items:center; background:linear-gradient(135deg, var(--green), var(--olive));
      color:#fff; border-radius:14px; box-shadow:var(--shadow)}
    .brand strong{font-size:1.05rem}
    nav a{color:var(--olive); text-decoration:none; margin-inline:10px; font-weight:600}
    nav a:hover{color:var(--green)}

    /* البطل */
    .hero{position:relative; max-width:1200px; margin:24px auto 18px; padding:20px; display:grid; grid-template-columns:1.1fr .9fr; gap:24px; align-items:center}
    .heroCard{background:rgba(255,255,255,.7); border:1px solid rgba(201,162,39,.15); border-radius:var(--radius); box-shadow:var(--shadow); padding:24px}
    .title{font-size:2.1rem; line-height:1.25; margin:0 0 8px; color:var(--olive)}
    .subtitle{color:var(--muted); margin:0 0 18px}
    .cta{display:flex; gap:12px; flex-wrap:wrap}
    .btn{appearance:none; border:none; border-radius:16px; padding:12px 16px; font-weight:700; cursor:pointer; transition:all .2s}
    .btn.primary{background:linear-gradient(135deg, var(--green), var(--olive)); color:#fff; box-shadow:0 4px 12px rgba(27,107,67,.2)}
    .btn.ghost{background:#fff; color:var(--green); border:1px solid rgba(27,107,67,.25)}
    .btn:hover{transform:translateY(-2px); box-shadow:0 6px 15px rgba(0,0,0,.1)}
    .profile{display:flex; gap:16px; align-items:center}
    .avatar{width:96px; height:96px; border-radius:50%; border:3px solid rgba(201,162,39,.3); box-shadow:0 6px 15px rgba(0,0,0,.08); object-fit:cover}
    .badge{display:inline-flex; gap:8px; align-items:center; color:var(--green); background:rgba(27,107,67,.1); border:1px dashed rgba(27,107,67,.35); padding:6px 10px; border-radius:999px; font-weight:700}

    /* قسم التلاوات */
    .section{max-width:1200px; margin:8px auto 40px; padding:0 20px}
    .section h2{margin:22px 0 14px; color:var(--olive); position:relative; padding-right:15px}
    .section h2::before{content:""; position:absolute; right:0; top:50%; transform:translateY(-50%); width:8px; height:24px; background:linear-gradient(to bottom, var(--green), var(--olive)); border-radius:4px}
    .tools{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin:8px 0 18px}
    .tools input[type="search"]{flex:1 1 260px; padding:12px 14px; border-radius:14px; border:1px solid rgba(201,162,39,.25); outline:none; background:rgba(255,255,255,.7); font-family:inherit}
    .tools select{padding:12px 14px; border-radius:14px; border:1px solid rgba(201,162,39,.25); background:rgba(255,255,255,.7); font-family:inherit}

    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:16px}
    @media (max-width:620px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card); border:1px solid rgba(201,162,39,.15); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column; transition:all .2s}
    .card:hover{transform:translateY(-5px); box-shadow:0 15px 30px rgba(0,0,0,.08)}
    .cover{position:relative; aspect-ratio:16/9; background:linear-gradient(135deg, #f6faf7, #fff)}
    .cover img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .cover .label{position:absolute; inset:auto 12px 12px 12px; background:rgba(255,255,255,.9); border:1px solid rgba(201,162,39,.2); color:var(--olive); padding:6px 10px; border-radius:12px; font-weight:700; backdrop-filter:blur(4px)}
    .meta{padding:12px 14px 8px}
    .meta h3{margin:0 0 6px; font-size:1.05rem; color:var(--green); font-weight:800}
    .meta p{margin:0; color:var(--muted); font-size:.95rem}
    .actions{display:flex; gap:10px; align-items:center; padding:12px 14px 16px}
    .actions .play{flex:1; background:linear-gradient(135deg, var(--green), var(--olive)); color:#fff; border:none; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer; transition:all .2s}
    .actions .play:hover{transform:translateY(-2px); box-shadow:0 4px 12px rgba(27,107,67,.3)}
    .actions .dl{background:#fff; border:1px solid rgba(201,162,39,.25); color:var(--olive); padding:10px 14px; border-radius:12px; font-weight:700; text-decoration:none; transition:all .2s}
    .actions .dl:hover{transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .nowPlaying{outline:2px solid var(--gold); box-shadow:0 15px 30px rgba(201,162,39,.2)}

    /* عن الشيخ + تواصل */
    .about, .contact{background:rgba(255,255,255,.7); border:1px solid rgba(201,162,39,.15); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px}
    .contact a{color:var(--green); font-weight:700}

    /* مُشغّل ثابت أسفل الصفحة */
    .player{position:sticky; bottom:0; z-index:50; background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(248,245,240,.95));
      border-top:1px solid rgba(201,162,39,.15); box-shadow:0 -8px 24px rgba(0,0,0,.06);
      transform:translateY(100%); transition:transform .3s ease;
    }
    .player.show{transform:translateY(0)}
    .playerInner{max-width:1200px; margin:auto; padding:10px 14px; display:grid; grid-template-columns:auto 1fr auto auto; gap:12px; align-items:center; position:relative}
    .miniCover{width:52px; height:52px; border-radius:12px; overflow:hidden; border:1px solid rgba(201,162,39,.25); box-shadow:var(--shadow)}
    .trackInfo{min-width:0}
    .trackTitle{font-weight:800; color:var(--olive); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .trackSub{font-size:.9rem; color:var(--muted)}
    .controls{display:flex; align-items:center; gap:10px}
    .iconBtn{width:42px; height:42px; border-radius:999px; border:1px solid rgba(201,162,39,.25); background:#fff; display:grid; place-items:center; cursor:pointer; transition:all .2s}
    .iconBtn:hover{transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .iconBtn.primary{background:linear-gradient(135deg, var(--green), var(--olive)); color:#fff; border:none; width:50px; height:50px; font-weight:800; box-shadow:0 4px 12px rgba(27,107,67,.3)}
    .iconBtn.primary:hover{transform:translateY(-2px); box-shadow:0 6px 15px rgba(27,107,67,.4)}
    .progressWrap{grid-column:1/-1; display:flex; align-items:center; gap:10px; padding:0 4px}
    input[type="range"]{appearance:none; width:100%; height:8px; background:rgba(201,162,39,.15); border-radius:999px; outline:none}
    input[type="range"]::-webkit-slider-thumb{appearance:none; width:18px; height:18px; background:var(--green); border-radius:50%; border:2px solid #fff; box-shadow:0 2px 6px rgba(0,0,0,.18)}
    .time{font-variant-numeric:tabular-nums; color:var(--muted); font-weight:700}
    .closeBtn{width:36px; height:36px; border-radius:50%; background:rgba(0,0,0,.05); display:grid; place-items:center; cursor:pointer; transition:all .2s}
    .closeBtn:hover{background:rgba(0,0,0,.1); transform:rotate(90deg)}

    footer{max-width:1200px; margin:20px auto 70px; padding:0 20px; color:var(--muted); display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap}
    footer b{color:var(--olive)}

    /* تحسين إمكانية القراءة */
    .visually-hidden{position:absolute!important; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <!-- خلفية زخرفية متحركة -->
  <div class="pattern" aria-hidden="true"></div>

  <!-- رأس الموقع -->
  <header>
    <div class="nav">
      <a class="brand" href="#top" aria-label="الصفحة الرئيسية">
        <div class="logo" aria-hidden="true">
          <!-- أيقونة مسجد بسيطة -->
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2l2 2-2 2-2-2 2-2Z" fill="currentColor"/>
            <path d="M5 10l7-4 7 4v10H5V10Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M9 20v-5a3 3 0 116 0v5" stroke="currentColor" stroke-width="1.5"/>
          </svg>
        </div>
        <strong>تلاوات د. محمد نبيل</strong>
      </a>
      <nav>
        <a href="#tracks">التلاوات</a>
        <a href="#about">عن الشيخ</a>
        <a href="#contact">تواصل</a>
      </nav>
    </div>
  </header>

  <!-- قسم البطل -->
  <section class="hero" id="top">
    <div class="heroCard">
      <h1 class="title">بسم الله — تلاوات <span style="color:var(--green)">د. محمد نبيل</span></h1>
      <p class="subtitle">تسجيلات صوتية مرتلة بتلاوة خاشعة، مع واجهة نظيفة وألوان إسلامية.</p>
      <div class="profile" style="margin-bottom:14px">
        <!-- استبدل مسار الصورة التالية بصورة الشيخ -->
      <img class="avatar" src="dr-nabil.jpg" alt="صورة د. محمد نبيل"/>
  <div>
          <div class="badge" aria-label="الصفة">قارئ القرآن الكريم</div>
          <div style="margin-top:8px; color:var(--muted)">مرحبا بكم في الموقع الرسمي للتلاوات.</div>
        </div>
      </div>
      <div class="cta">
        <a class="btn primary" href="#tracks">ابدأ الاستماع الآن</a>
        <a class="btn ghost" href="#contact">تواصل معنا</a>
      </div>
    </div>
    <div class="heroCard">
      <h2 style="margin:0 0 10px; color:var(--green)">تنبيه</h2>
      <p style="margin:0; color:var(--muted)">لوحة التحكم أدناه تمنحك تشغيلاً سريعًا، بحثًا، وفرزًا للتلاوات. يمكن تخصيص كل شيء بسهولة من داخل هذا الملف الواحد.</p>
      <ul style="margin:12px 0 0; padding-inline-start:20px; color:var(--muted)">
        <li>اضغط <b>مسافة</b> لإيقاف/تشغيل.</li>
        <li><b>N</b> التالي — <b>P</b> السابق.</li>
        <li>الأسهم يمين/يسار: تقديم/ترجيع 10 ثوانٍ.</li>
      </ul>
    </div>
  </section>

  <!-- قسم التلاوات -->
  <section class="section" id="tracks">
    <h2>التلاوات</h2>
    <div class="tools">
      <input id="search" type="search" placeholder="ابحث باسم السورة أو رقم الآية…" aria-label="بحث" />
      <select id="sort" aria-label="فرز">
        <option value="default">الافتراضي</option>
        <option value="surah">حسب اسم السورة (أ-ي)</option>
        <option value="length">حسب عدد الآيات</option>
      </select>
    </div>
    <div id="grid" class="grid" aria-live="polite"></div>
  </section>

  <!-- عن الشيخ -->
  <section class="section" id="about">
    <div class="about">
      <h2>عن الشيخ</h2>
      <p>الدكتور محمد نبيل هو قارئ القرآن الكريم المعروف بصوته العذب وتلاوته الخاشعة. يتميز بإتقانه لأحكام التجويد وتفسيره الواضح للآيات.</p>
    </div>
  </section>

  <!-- تواصل -->
  <section class="section" id="contact">
    <div class="contact">
      <h2>تواصل</h2>
      <p>للاقتراحات أو طلب نشر تلاوة جديدة: 
        <!-- استبدل الروابط أدناه ببيانات التواصل الحقيقية -->
        <a href="https://wa.me/201010238579"_blank" rel="noopener">واتساب</a> •
        <a href="mailto:info@example.com">البريد الإلكتروني</a>
      </p>
    </div>
  </section>

  <!-- مشغّل سفلي ثابت -->
  <div class="player" role="region" aria-label="مشغّل الصوت" id="audioPlayer">
    <div class="playerInner">
      <img id="miniCover" class="miniCover" alt="غلاف التلاوة" src="" />
      <div class="trackInfo">
        <div id="trackTitle" class="trackTitle">—</div>
        <div id="trackSub" class="trackSub">—</div>
      </div>
      <div class="controls">
        <button id="prevBtn" class="iconBtn" aria-label="السابق" title="السابق">
          <!-- رمز السابق -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 5v14" stroke="currentColor" stroke-width="2"/><path d="M19 6l-9 6 9 6V6z" fill="currentColor"/></svg>
        </button>
        <button id="playBtn" class="iconBtn primary" aria-label="تشغيل/إيقاف" title="تشغيل/إيقاف">
          <!-- رمز تشغيل -->
          <svg id="playIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7L8 5z"/></svg>
        </button>
        <button id="nextBtn" class="iconBtn" aria-label="التالي" title="التالي">
          <!-- رمز التالي -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 5v14" stroke="currentColor" stroke-width="2"/><path d="M5 6l9 6-9 6V6z" fill="currentColor"/></svg>
        </button>
      </div>
      <button id="closeBtn" class="closeBtn" aria-label="إغلاق المشغل" title="إغلاق">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6l12 12" stroke="var(--muted)" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="progressWrap">
        <span id="currentTime" class="time">00:00</span>
        <input id="seek" type="range" min="0" max="1000" value="0" aria-label="شريط التقدم"/>
        <span id="duration" class="time">00:00</span>
      </div>
    </div>
  </div>

  <footer>
    <div>© <span id="year"></span> جميع الحقوق محفوظة — <b>تلاوات د. محمد نبيل</b></div>
    <div></div>
  </footer>

  <script>
    // ====== بيانات التلاوات (عدّل كما تشاء) ======
    // ملاحظة: ضع الملفات داخل مجلد "audio/" و"covers/" أو استخدم روابط مباشرة.
    // إذا لم تكن الملفات موجودة، سيظهر تنبيه عند محاولة التشغيل.

    const tracks = [
      { id: 1, surah: "الفاتحة", from: 1, to: 7, src: "m1.mp3" },
      { id: 2, surah: "البقرة", from: 1, to: 5, src: "m2.mp3" },
      { id: 3, surah: "البقرة", from: 6, to: 10, src: "m3.mp3" },
      { id: 4, surah: "البقرة", from: 11, to: 15, src: "m4.mp3" },
      { id: 5, surah: "البقرة", from: 16, to: 20, src: "m5.mp3" },
      { id: 6, surah: "البقرة", from: 21, to: 25, src: "m6.mp3" },
      { id: 7, surah: "البقرة", from: 26, to: 30, src: "m7.mp3" },
      { id: 8, surah: "البقرة", from: 31, to: 35, src: "m8.mp3" },
      { id: 9, surah: "البقرة", from: 36, to: 40, src: "m9.mp3" },
      { id: 10, surah: "البقرة", from: 41, to: 45, src: "m10.mp3" },
      { id: 11, surah: "البقرة", from: 46, to: 50, src: "m11.mp3" },
      { id: 12, surah: "البقرة", from: 51, to: 55, src: "m12.mp3" },
      { id: 13, surah: "البقرة", from: 56, to: 60, src: "m13.mp3" },
      { id: 14, surah: "البقرة", from: 61, to: 65, src: "m14.mp3" },
      { id: 15, surah: "البقرة", from: 66, to: 70, src: "m15.mp3" },
      { id: 16, surah: "البقرة", from: 71, to: 75, src: "m16.mp3" },
      { id: 17, surah: "البقرة", from: 76, to: 80, src: "m17.mp3" },
      { id: 18, surah: "البقرة", from: 81, to: 85, src: "m18.mp3" },
      { id: 19, surah: "البقرة", from: 86, to: 90, src: "m19.mp3" },
      { id: 20, surah: "البقرة", from: 91, to: 95, src: "m20.mp3" },
      { id: 21, surah: "البقرة", from: 96, to: 100, src: "m21.mp3" },
      { id: 22, surah: "البقرة", from: 101, to: 105, src: "m22.mp3" },
      { id: 23, surah: "البقرة", from: 106, to: 110, src: "m23.mp3" },
      { id: 24, surah: "البقرة", from: 111, to: 115, src: "m24.mp3" },
      { id: 25, surah: "البقرة", from: 116, to: 120, src: "m25.mp3" },
      { id: 26, surah: "البقرة", from: 121, to: 125, src: "m26.mp3" },
      { id: 27, surah: "البقرة", from: 126, to: 130, src: "m27.mp3" },
      { id: 28, surah: "البقرة", from: 131, to: 135, src: "m28.mp3" },
      { id: 29, surah: "البقرة", from: 136, to: 140, src: "m29.mp3" },
      { id: 30, surah: "البقرة", from: 141, to: 145, src: "m30.mp3" },
      { id: 31, surah: "البقرة", from: 146, to: 150, src: "m31.mp3" },
      { id: 32, surah: "البقرة", from: 151, to: 155, src: "m32.mp3" },
      { id: 33, surah: "البقرة", from: 156, to: 160, src: "m33.mp3" },
      { id: 34, surah: "البقرة", from: 161, to: 165, src: "m34.mp3" },
      { id: 35, surah: "البقرة", from: 166, to: 170, src: "m35.mp3" },
      { id: 36, surah: "البقرة", from: 171, to: 175, src: "m36.mp3" },
      { id: 37, surah: "البقرة", from: 176, to: 180, src: "m37.mp3" },
      { id: 38, surah: "البقرة", from: 181, to: 185, src: "m38.mp3" },
      { id: 39, surah: "البقرة", from: 186, to: 190, src: "m39.mp3" },
      { id: 40, surah: "البقرة", from: 191, to: 195, src: "m40.mp3" }
    ];

    // توليد غلاف SVG لكل سورة — لون أخضر/زيتي مع كتابتها
    function svgCover(title){
      const svg = encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' width='1200' height='675' viewBox='0 0 1200 675'>
          <defs>
            <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
              <stop offset='0' stop-color='%231b6b43'/>
              <stop offset='1' stop-color='%232e5e4e'/>
            </linearGradient>
            <pattern id='p' width='60' height='60' patternUnits='userSpaceOnUse' patternTransform='rotate(45)'>
              <circle cx='30' cy='30' r='2' fill='rgba(255,255,255,.22)'/>
              <path d='M0 30h60 M30 0v60' stroke='rgba(255,255,255,.08)'/>
            </pattern>
          </defs>
          <rect width='1200' height='675' fill='url(%23g)'/>
          <rect width='1200' height='675' fill='url(%23p)'/>
          <rect x='60' y='480' width='1080' height='120' rx='18' fill='rgba(255,255,255,.92)' stroke='rgba(255,255,255,.7)'/>
          <text x='600' y='555' text-anchor='middle' font-family='Cairo, sans-serif' font-size='52' font-weight='800' fill='%232e5e4e'>${title}</text>
          <text x='600' y='120' text-anchor='middle' font-family='Cairo, sans-serif' font-size='28' font-weight='700' fill='rgba(255,255,255,.95)'>تلاوات د. محمد نبيل</text>
        </svg>`);
      return `data:image/svg+xml,${svg}`;
    }

    // ====== بناء بطاقات التلاوات ======
    const grid = document.getElementById('grid');
    function render(list){
      grid.innerHTML = '';
      list.forEach((t, idx) => {
        const card = document.createElement('article');
        card.className = 'card';
        card.dataset.id = t.id;

        const cover = document.createElement('div');
        cover.className = 'cover';
        const img = document.createElement('img');
        img.alt = `غلاف ${t.surah}`;
        img.src = svgCover(`سورة ${t.surah} — ${t.from}-${t.to}`);
        cover.appendChild(img);
        const lab = document.createElement('div');
        lab.className = 'label';
        lab.textContent = `سورة ${t.surah} — من الآية ${t.from} إلى ${t.to}`;
        cover.appendChild(lab);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const h3 = document.createElement('h3');
        h3.textContent = `تلاوة سورة ${t.surah}`;
        const p = document.createElement('p');
        p.textContent = `من الآية ${t.from} إلى ${t.to}`;
        meta.appendChild(h3); meta.appendChild(p);

        const actions = document.createElement('div');
        actions.className = 'actions';
        const btn = document.createElement('button');
        btn.className = 'play'; btn.textContent = 'تشغيل';
        btn.addEventListener('click', () => playTrackById(t.id));
        const dl = document.createElement('a');
        dl.className = 'dl'; dl.textContent = 'تحميل'; dl.href = t.src; dl.setAttribute('download', '');
        actions.appendChild(btn); actions.appendChild(dl);

        card.appendChild(cover); card.appendChild(meta); card.appendChild(actions);
        grid.appendChild(card);
      });
    }

    // ====== بحث وفرز ======
    const search = document.getElementById('search');
    const sortSel = document.getElementById('sort');
    function applyFilters(){
      const q = search.value.trim();
      let list = tracks.filter(t => {
        const hay = `${t.surah} ${t.from} ${t.to}`;
        return hay.includes(q);
      });
      const mode = sortSel.value;
      if(mode === 'surah') list.sort((a,b) => a.surah.localeCompare(b.surah, 'ar'));
      if(mode === 'length') list.sort((a,b) => (a.to - a.from) - (b.to - b.from));
      render(list);
      highlightCurrent();
    }
    search.addEventListener('input', applyFilters);
    sortSel.addEventListener('change', applyFilters);

    // ====== مشغّل الصوت ======
    const audio = new Audio();
    audio.preload = 'metadata';

    let currentIndex = 0; // مؤشر داخل المصفوفة

    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const seek = document.getElementById('seek');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const miniCover = document.getElementById('miniCover');
    const trackTitle = document.getElementById('trackTitle');
    const trackSub = document.getElementById('trackSub');
    const audioPlayer = document.getElementById('audioPlayer');
    const closeBtn = document.getElementById('closeBtn');

    function fmtTime(s){
      if(!isFinite(s)) return '00:00';
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const sec = Math.floor(s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }

    function load(index){
      currentIndex = (index + tracks.length) % tracks.length;
      const t = tracks[currentIndex];
      audio.src = t.src;
      trackTitle.textContent = `سورة ${t.surah}`;
      trackSub.textContent = `من الآية ${t.from} إلى ${t.to} — بصوت د. محمد نبيل`;
      const cover = svgCover(`سورة ${t.surah} — ${t.from}-${t.to}`);
      miniCover.src = cover;
      // حفظ آخر حالة
      localStorage.setItem('quran.player.index', String(currentIndex));
    }

    function showPlayer(){
      audioPlayer.classList.add('show');
    }

    function hidePlayer(){
      audioPlayer.classList.remove('show');
    }

    function play(){
      audio.play().then(()=>{
        playIcon.outerHTML = `<svg id="playIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d='M6 5h4v14H6zM14 5h4v14h-4z'/></svg>`;
        highlightCurrent();
        showPlayer();
     
        console.warn(err);
      });
    }
    function pause(){
      audio.pause();
      playIcon.outerHTML = `<svg id="playIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d='M8 5v14l11-7L8 5z'/></svg>`;
    }

    playBtn.addEventListener('click', ()=> audio.paused ? play() : pause());
    prevBtn.addEventListener('click', ()=>{ load(currentIndex-1); play(); scrollIntoViewCard(); });
    nextBtn.addEventListener('click', ()=>{ load(currentIndex+1); play(); scrollIntoViewCard(); });
    closeBtn.addEventListener('click', ()=>{ pause(); hidePlayer(); });

    audio.addEventListener('loadedmetadata', ()=>{
      durationEl.textContent = fmtTime(audio.duration);
    });
    audio.addEventListener('timeupdate', ()=>{
      currentTimeEl.textContent = fmtTime(audio.currentTime);
      const ratio = (audio.currentTime / (audio.duration||1));
      seek.value = Math.floor(ratio * 1000);
    });
    audio.addEventListener('ended', ()=>{
      load(currentIndex+1); play();
    });

    seek.addEventListener('input', ()=>{
      const ratio = seek.value / 1000;
      audio.currentTime = ratio * (audio.duration||0);
    });

    // تمييز البطاقة المشغّلة
    function highlightCurrent(){
      document.querySelectorAll('.card').forEach(c=>c.classList.remove('nowPlaying'));
      const t = tracks[currentIndex];
      const el = document.querySelector(`.card[data-id="${t.id}"]`);
      if(el) el.classList.add('nowPlaying');
    }

    function scrollIntoViewCard(){
      const t = tracks[currentIndex];
      const el = document.querySelector(`.card[data-id="${t.id}"]`);
      if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
    }

    // تشغيل بطاقة معينة بالمعرّف
    function playTrackById(id){
      const idx = tracks.findIndex(x => x.id === id);
      if(idx !== -1){ load(idx); play(); }
    }

    // مفاتيح سريعة
    window.addEventListener('keydown', (e)=>{
      const tag = (e.target && e.target.tagName)||'';
      if(tag === 'INPUT' || tag === 'TEXTAREA') return; // تجاهل أثناء الكتابة
      if(e.code === 'Space'){ e.preventDefault(); audio.paused? play(): pause(); }
      if(e.key.toLowerCase() === 'n'){ e.preventDefault(); load(currentIndex+1); play(); scrollIntoViewCard(); }
      if(e.key.toLowerCase() === 'p'){ e.preventDefault(); load(currentIndex-1); play(); scrollIntoViewCard(); }
      if(e.key === 'ArrowRight'){ audio.currentTime = Math.min(audio.currentTime + 10, audio.duration||audio.currentTime); }
      if(e.key === 'ArrowLeft'){ audio.currentTime = Math.max(audio.currentTime - 10, 0); }
    });

    // استعادة آخر مسار إن وُجد
    const saved = parseInt(localStorage.getItem('quran.player.index')||'0',10);
    load(Number.isFinite(saved)? saved : 0);

    // بناء الواجهة أول مرة
    render(tracks);
    applyFilters();

    // سنة الفوتر
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>